[![Pull Request Docs Check](https://github.com/blockchain-v/bcv-backend/actions/workflows/main.yml/badge.svg)](https://github.com/blockchain-v/bcv-backend/actions/workflows/main.yml)
[![pages-build-deployment](https://github.com/blockchain-v/bcv-backend/actions/workflows/pages/pages-build-deployment/badge.svg)](https://github.com/blockchain-v/bcv-backend/actions/workflows/pages/pages-build-deployment)

# BCV-Backend

- API documentation can be found at: `http://localhost:8080/api/v1/bcv/ui/`
- Code documentation can be found at Github-page

# how to run this:
- dependencies are in requirements.txt, python 3.8 works (3.10 not supported)

assumed folder structure:

`blockchain-v/bcv-contract`

`blockchain-v/bcv-frontend`

`blockchain-v/bcv-backend`

`blockchain-v/bcv-docker`

1. start ganache, optionally add the `truffle-config.js` as project to read the smart contract values and see events
2. cd into `bcv-contract/src` and run `truffle migrate --reset`
3. Inside the `blockchain-v/bcv-docker` directory:
   1. start db: `docker compose up db`
   2. start frontend: `docker compse up bcv-frontend` (might require .env changes)
4. start the Tacker VM
5. adjust your backend .env 
   1. to your local tacker VM config (can be read from the tacker dashboard at API Access)
   2. the SC addresses to ones from your local ganache setup (will be used to register the backend)
6. run the backend:
   1. local development: start the backend in `blockchain-v/bcv-backend` directory:
      1. `pip3 install -r test-requirements.txt`
      2. `python3 -m openapi_server` 
   2. Or inside the `blockchain-v/bcv-docker` directory: `docker compse up bcv-frontend`

### Tests
- `
pip3 install -r test-requirements.txt
`
- run
`
pytest --cov=openapi_server
`


### Contributing
This project uses [Black](https://github.com/psf/black) for code formatting in a pre-commit hook.

C.f. [pre-commit installation](https://pre-commit.com/)

# OpenAPI generated server

## Overview
This server was generated by the [OpenAPI Generator](https://openapi-generator.tech) project. By using the
[OpenAPI-Spec](https://openapis.org) from a remote server, you can easily generate a server stub.  This
is an example of building a OpenAPI-enabled Flask server.

This example uses the [Connexion](https://github.com/zalando/connexion) library on top of Flask.

## Requirements
Python 3.5.2+

## Usage
To run the server, please execute the following from the root directory:

```
pip3 install -r requirements.txt
python3 -m openapi_server
```

and open your browser to here:

```
http://localhost:8080/api/v1/bcv/ui/
```

Your OpenAPI definition lives here:

```
http://localhost:8080/api/v1/bcv/openapi.json
```

To launch the integration tests, use tox:
```
sudo pip install tox
tox
```


## ENV File 
The backend expects the .env file to have these attributes:

Tacker settings can be read from the Tacker Dashboard

```TACKER_USERNAME```=

```TACKER_PASSWORD```=

```TACKER_TENANT_NAME```=

```TACKER_TENANT_ID```=

```TACKER_USER_ID```=

```TACKER_AUTH_URL```=http://...:8080/identity/v3/auth

```TACKER_ENDPOINT_URL```=http://...:9890/

```TACKER_BASEURL```=http://.../v1.0/


The Address of the backend:

```SC_BACKEND_ADDRESS```=

```SC_BACKEND_ADDRESS_PKEY```=

The Address of the SC creater:

```SC_BACKEND_ADDRESS_FROM```=

```SC_BACKEND_ADDRESS_FROM_PKEY```=


```W3_URL```=http://127.0.0.1:7545

```W3_CONTRACT_ADDRESS```=

```SC_ABI_PATH```= ./openapi_server/contract/VNFDeployment.json

```PORT```=8080

```JWT_SECRET```=
